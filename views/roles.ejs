<!-- @format -->
<link rel="stylesheet" href="/public/css/insert.css"/>
<div class="main-content p-4">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="card shadow-sm p-4 mb-4">
                    <h3 class="text-center mb-4">Roles Management</h3>
                    <form action="/administrator/insert-role" method="POST" class="form-edit">
                        <input type="hidden" name="_token" value="<%= csrfToken %>">
                        <input type="text" name="_id" class="idInput" hidden/>
                        <input type="hidden" name="editMode" class="editModeInput" value="false" />
                        <div class="mb-3">
                            <label for="role" class="form-label">Role</label>
                            <input
                                    type="text"
                                    name="role"
                                    id="role"
                                    placeholder="Enter new role"
                                    class="form-control roleInput"
                                    required
                            />
                        </div>
                        <div class="mb-3">
                            <label for="roleid" class="form-label">Role Id</label>
                            <input
                                    type="number"
                                    name="roleId"
                                    id="roleid"
                                    placeholder="Enter new role"
                                    class="form-control roleIdInput"
                                    required
                            />
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea
                                    rows="4"
                                    name="description"
                                    id="description"
                                    placeholder="Type your description"
                                    class="form-control descriptionInput"
                                    required
                            ></textarea>
                        </div>
                        <div class="mb-3">
                            <p class="mb-2">Permission</p>
                            <div class="form-check form-switch mb-1">
                                <input
                                        class="form-check-input postRadio"
                                        type="checkbox"
                                        role="switch"
                                        id="postPermit"
                                        name="postPermit"
                                        value="1"
                                />
                                <label class="form-check-label" for="postPermit">(1) Posts Management</label>
                            </div>
                            <div class="form-check form-switch mb-1">
                                <input
                                        class="form-check-input categoryRadio"
                                        type="checkbox"
                                        role="switch"
                                        id="categoryPermit"
                                        name="categoryPermit"
                                        value="2"
                                />
                                <label class="form-check-label" for="categoryPermit">(2) Categories Management</label>
                            </div>
                            <div class="form-check form-switch mb-1">
                                <input
                                        class="form-check-input roleRadio"
                                        type="checkbox"
                                        role="switch"
                                        id="rolePermit"
                                        name="rolePermit"
                                        value="3"
                                />
                                <label class="form-check-label" for="rolePermit">(3) Role Management</label>
                            </div>
                            <div class="form-check form-switch mb-1">
                                <input
                                        class="form-check-input userRadio"
                                        type="checkbox"
                                        role="switch"
                                        id="userPermit"
                                        name="userPermit"
                                        value="4"
                                />
                                <label class="form-check-label" for="userPermit">(4) User Management</label>
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-danger rounded-pill" type="button" onclick="clearInput()">Clear</button>
                            <button class="btn btn-success rounded-pill" type="submit">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="card shadow-sm p-4 mb-4">
            <div class="table-responsive">
                <table class="table table-borderless table-hover datatable">
                    <thead class="table-light">
                    <tr>
                        <th>No</th>
                        <th>Role Title</th>
                        <th>Role Id</th>
                        <th>Description</th>
                        <th>Permission</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% let number = 1; role.forEach(e => { %>
                        <tr>
                            <td><%= number++ %></td>
                            <td><%= e.role %></td>
                            <td><%= e.roleId %></td>
                            <td><%= e.description %></td>
                            <td><%= e.permission %></td>
                            <td class="d-flex gap-1">
                                <button
                                        class="btn btn-warning btn-edit btn-sm rounded-pill"
                                        onclick="edit(`<%- number - 2 %>`)"
                                >
                                    Edit
                                </button>
                                <form action="/delete-role/<%= e.id %>" method="get" class="d-inline">
                                    <button
                                            class="btn btn-danger btn-delete btn-sm rounded-pill"
                                            type="submit"
                                    >
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<link
        rel="stylesheet"
        type="text/css"
        href="/public/css/datatables.min.css"
/>
<script src="/public/js/datatables.min.js"></script>
<script>
    $(document).ready(function () {
        $(".datatable").DataTable();
    });
</script>

<!-- rhs -->
<div class="data d-none">
    <% role.forEach(e => { %>
        <div class="roles">
            <div class="id"><%= e._id %></div>
            <div class="role"><%= e.role %></div>
            <div class="roleId"><%= e.roleId %></div>
            <div class="permission"><%= e.permission %></div>
            <div class="description"><%= e.description %></div>
        </div>
    <% }) %>
</div>
<script>
    const inputID = document.querySelector(".idInput");
    const inputRole = document.querySelector(".roleInput");
    const inputRoleID = document.querySelector(".roleIdInput");
    const inputDescription = document.querySelector(".descriptionInput");
    const postRadio = document.querySelector(".postRadio");
    const categoryRadio = document.querySelector(".categoryRadio");
    const roleRadio = document.querySelector(".roleRadio");
    const userRadio = document.querySelector(".userRadio");
    const editModeInput = document.querySelector(".editModeInput");
    const form = document.querySelector(".form-edit");

    function edit(target) {
        const id = document.querySelectorAll(".id");
        const role = document.querySelectorAll(".role");
        const roleId = document.querySelectorAll(".roleId");
        const permission = document.querySelectorAll(".permission");
        const description = document.querySelectorAll(".description");

        inputID.value = id[target].innerHTML;
        inputRole.value = role[target].innerHTML;
        inputRoleID.value = roleId[target].innerHTML;
        inputDescription.value = description[target].innerHTML;
        editModeInput.value = "true";

        const splitPermit = permission[target].innerHTML.split("");

        postRadio.checked = splitPermit.includes("1");
        categoryRadio.checked = splitPermit.includes("2");
        roleRadio.checked = splitPermit.includes("3");
        userRadio.checked = splitPermit.includes("4");

        form.action = "/administrator/edit-role";
    }

    function clearInput() {
        inputID.value = "";
        inputRole.value = "";
        inputRoleID.value = "";
        inputDescription.value = "";
        postRadio.checked = false;
        categoryRadio.checked = false;
        roleRadio.checked = false;
        userRadio.checked = false;
        form.action = "/administrator/insert-role";
        editModeInput.value = "false";
    }
    
    // Reset form to insert mode
    function resetForm() {
        form.action = "/administrator/insert-role";
        editModeInput.value = "false";
    }
    
    // Add event listener to form reset
    form.addEventListener('reset', resetForm);
</script>
